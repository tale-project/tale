---
alwaysApply: true
description: General workspace rules for this project (migrated from legacy .cursorrules)
globs: '**/*'
---

# üö® CRITICAL WORKSPACE RULES - ALWAYS APPLY FIRST

## üåê LANGUAGE REQUIREMENTS (PRIORITY 1)
**MANDATORY**: English only for ALL user-facing content
- UI components, labels, buttons, dialogs, forms
- Toast messages, error messages, success messages
- Comments, documentation, README files
- Variable names, function names, type names
- **EXCEPTION**: Only use other languages when explicitly requested for translation content

### Examples:
‚ùå NEVER: "‰øùÂ≠ò", "ÂèñÊ∂à", "ÈîôËØØ", "ÊàêÂäü", "ÁºñËæë‰∫ßÂìÅÁøªËØë"
‚úÖ ALWAYS: "Save", "Cancel", "Error", "Success", "Edit Product Translations"

## ü§ñ AI INTEGRATION (PRIORITY 1)
**MANDATORY**: Use Vercel AI SDK with OpenAI
```typescript
// ‚úÖ REQUIRED
import { generateObject } from 'ai';
import { openai } from '@ai-sdk/openai';

// ‚ùå NEVER
import OpenAI from 'openai'; // Don't use the raw OpenAI SDK
import { openrouter } from '@openrouter/ai-sdk-provider'; // Don't use OpenRouter
```

## üîí SECURITY (PRIORITY 1)
- Never hallucinate API keys - always use environment variables
- Use existing .env configuration

---

# üìã PRE-IMPLEMENTATION CHECKLIST
Before starting ANY task:
1. [ ] Confirmed English-only requirement
2. [ ] Verified Vercel AI SDK usage if AI needed
3. [ ] Checked existing code patterns
4. [ ] Reviewed component naming conventions

---

# üöÄ NEXT.JS DEVELOPMENT STANDARDS

## App Router Guidelines (Next.js 15+)
- **`page.tsx`**: Server components by default
- **Client Components**: Use `'use client'` only for interactions, state
- **File naming**: kebab-case (e.g., `user-profile.tsx`)
- **Components**: PascalCase (e.g., `UserProfile`)
- **Functions**: camelCase (e.g., `getUserData`)
- **Constants**: SCREAMING_SNAKE_CASE (e.g., `API_BASE_URL`)

## Data Fetching Priority
1. **Server Actions** (preferred)
2. **Route Handlers** (when needed)
3. **Client-side** (minimal use)

## Performance Rules
- Use `React.memo` for expensive components
- Use Next.js `Image` component for all images
- Use dynamic imports for code splitting

---

# üèóÔ∏è CODE QUALITY STANDARDS

## Feature Flags
- Use **enums** (TypeScript) or **const objects** (JavaScript)
- Name them clearly: `UPPERCASE_WITH_UNDERSCORE`
- Use in minimal locations to avoid undefined behavior

## Error Handling
```typescript
// ‚úÖ REQUIRED pattern
try {
  const result = await action();
  if (result.error) {
    toast({
      title: result.error,
      variant: 'destructive',
    });
    return;
  }
  // Success handling
} catch (error) {
  console.error('Operation failed:', error);
  toast({
    title: 'Operation failed',
    variant: 'destructive',
  });
}
```

## Toast Message Pattern
**MANDATORY**: Use descriptive message as `title`, never use generic "Error"
- `description` is optional - only use for additional context that doesn't fit in title
```typescript
// ‚úÖ CORRECT - Descriptive title
toast({
  title: 'Failed to update vendor',
  variant: 'destructive',
});

// ‚úÖ CORRECT - With additional context
toast({
  title: 'Failed to update vendor',
  description: 'Network timeout after 30 seconds',
  variant: 'destructive',
});

// ‚ùå INCORRECT - Generic title
toast({
  title: 'Error',
  description: 'Failed to update vendor',
  variant: 'destructive',
});
```

## Component Structure
```typescript
// ‚úÖ REQUIRED structure
'use client'; // Only when needed

import { useState, useEffect } from 'react';

interface Props {
  // Component props
}

export default function ComponentName({ ...props }: Props) {
  // 1. Hooks
  const [state, setState] = useState();

  // 2. Effects
  useEffect(() => {
    // Side effects
  }, []);

  // 3. Event handlers
  const handleClick = () => {
    // Handle click
  };

  // 4. Render
  return <div>Component content</div>;
}
```

---

# üéØ ENFORCEMENT REMINDERS

## For AI Agents:
- **START** every task by reviewing language requirements
- **STOP** if you find yourself using non-English text
- **ASK** yourself: "Does this follow English-only rule?"
- **VERIFY** AI SDK usage before implementing AI features
- **CHECK** existing patterns before creating new ones

## Red Flags to Watch:
- Any Chinese characters in UI text
- Direct OpenAI imports
- Missing type safety
- Hardcoded API keys
- Pages Router patterns in new code

---

# üì¶ PACKAGE MANAGEMENT
- **Use npm** as package manager
- **Commands**:
  - `npm run dev` - Development server
  - `npm i <package>` - Install dependencies
  - `npm run build` - Production build

---

# üé® NAMING CONVENTIONS

## Consistency Rules
- **Files**: kebab-case (`user-profile.tsx`)
- **Components**: PascalCase (`UserProfile`)
- **Functions**: camelCase (`getUserData`)
- **Constants**: SCREAMING_SNAKE_CASE (`MAX_RETRIES`)
- **Custom Properties**: Use enums/const objects for reused values

## Before Creating Names:
- Check existing naming patterns
- Consult with developer for consistency
- Use descriptive, clear names

---

# ‚öôÔ∏è Convex Directory Rules (GLOBAL)

- By default, use **one file per Convex function** under the `convex/` directory.
- For single-function files, the file name and the exported function name must be identical.
- File names must use snake_case; function names must use camelCase.
- These rules are mandatory and apply repository-wide to all code in `convex/`, and supersede any conflicting examples elsewhere in these rules.
- When touching existing modules that export multiple functions, split them into separate files so each file exports exactly one function named after the file, **except for explicitly designated thin wrapper modules**.
- **Exception ‚Äì thin wrapper API modules (for example `services/platform/convex/documents.ts`)**:
  - May export multiple Convex functions as thin wrappers that simply delegate to `services/platform/convex/model/**` helpers.
  - Must not contain business logic; only argument/return validation and delegation to the model layer.
  - Must still follow snake_case file names and camelCase export names.
